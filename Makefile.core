include $(KOS_BASE)/Makefile.rules
KOS_CSTD := -std=gnu23
CC=kos-cc

# redefine the following in a file ./Makefile.local.cfg as necessary
include enDjinn/Makefile.cfg

ifneq (,$(wildcard ./Makefile.local.cfg))
    include Makefile.local.cfg
endif

# its all automagic from here on out
OBJS := $(shell find ./code/ -name '*.c' -not -path "./.git/*" |sed -e 's,\.\(.*\).c,$(BUILDDIR)\1.o,g')

include enDjinn/Makefile.texture
include enDjinn/Makefile.sfx
include enDjinn/Makefile.defines

all: $(BASENAME).elf
.DEFAULT: all

$(BUILDDIR)/%.o: %.c Makefile
	@mkdir -p $(shell dirname $@)
	$(CC) $(INCLUDES) $(CFLAGS) $(DEFINES) -c $< -o $@

${BASENAME}.elf: $(OBJS) $(DTTEXTURES) $(SFXFILES)
	@$(CC) $(INCLUDES) $(KOS_CFLAGS) $(DEFINES) -o $@ $(OBJS) $(LDLIBS) 

${BASENAME}.cdi: ${BASENAME}.elf
	mkdcdisc -n $(basename $<) -e ${BASENAME}.elf -d ${ROMDIR}/ -N -o $(basename $<).cdi -v 3 -m

${BASENAME}.bin: ${BASENAME}.elf
	sh-elf-objcopy -O binary ${BASENAME}.elf ${BASENAME}.bin

clean:
	-rm -rf *.elf *.cdi *.bin $(OBJS) 

.PRECIOUS: $(DTTEXTURES) $(SFXFILES) 
.PHONY: list help info

include enDjinn/Makefile.info
